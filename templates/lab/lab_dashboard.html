{% extends 'base.html' %}
{% block title %}Labor — Übersicht{% endblock %}
{% block content %}
<h3 class="mb-3">Labor-Übersicht</h3>

<div class="row g-3 mb-4">
  <div class="col-6 col-md-3"><div class="p-3 border rounded-3 text-center">
    <div class="text-muted">Eingegangen</div><div class="display-6">{{ counts.sent }}</div></div></div>
  <div class="col-6 col-md-3"><div class="p-3 border rounded-3 text-center">
    <div class="text-muted">Im Labor</div><div class="display-6">{{ counts.in_lab }}</div></div></div>
  <div class="col-6 col-md-3"><div class="p-3 border rounded-3 text-center">
    <div class="text-muted">Heute fällig</div><div class="display-6">{{ due_today }}</div></div></div>
  <div class="col-6 col-md-3"><div class="p-3 border rounded-3 text-center">
    <div class="text-muted">Überfällig</div><div class="display-6">{{ overdue }}</div></div></div>
</div>

<div class="d-flex justify-content-between align-items-baseline mb-2">
  <h5 class="mb-0">Neueste Fälle</h5>
  <a class="small text-decoration-none" href="{% url 'lab_cases' %}">Alle Fälle →</a>
</div>
<div class="table-responsive">
  <table class="table table-sm align-middle">
    <thead><tr><th>Fall</th><th>Patient</th><th>Status</th><th>Aktualisiert</th><th class="text-end">Aktion</th></tr></thead>
    <tbody>
    {% for c in recent %}
      <tr>
        <td class="fw-semibold">{{ c.case_code }}</td>
        <td>{{ c.patient_name }}</td>
        <td>{{ c.get_status_display }}</td>
        <td>{{ c.updated_at|date:'d.m.Y H:i' }}</td>
        <td class="text-end"><a class="btn btn-sm btn-outline-primary" href="{% url 'lab_case_detail' c.pk %}">Öffnen</a></td>
      </tr>
    {% empty %}
      <tr><td colspan="5" class="text-muted">Keine Fälle</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<h5 class="mt-4">Aktivitäten</h5>
<ul class="list-group">
  {% for e in events %}
    <li class="list-group-item small">
      <span class="text-muted">{{ e.created_at|date:'d.m.Y H:i' }}</span>
      — <strong>{{ e.action }}</strong>
      {% if e.payload.filename %} ({{ e.payload.filename }}){% endif %}
      {% if e.payload.tracking %} (Tracking: {{ e.payload.tracking }}){% endif %}
    </li>
  {% empty %}
    <li class="list-group-item text-muted">Keine Aktivitäten</li>
  {% endfor %}
</ul>
{% endblock %}
